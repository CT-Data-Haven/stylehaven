<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="stylehaven">
<title>Plot examples from the DCWS launch • stylehaven</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plot examples from the DCWS launch">
<meta property="og:description" content="stylehaven">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">stylehaven</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dcws_example_plots.html">Plot examples from the DCWS launch</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CT-Data-Haven/stylehaven/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Plot examples from the DCWS launch</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CT-Data-Haven/stylehaven/blob/HEAD/vignettes/dcws_example_plots.Rmd" class="external-link"><code>vignettes/dcws_example_plots.Rmd</code></a></small>
      <div class="d-none name"><code>dcws_example_plots.Rmd</code></div>
    </div>

    
    
<p>As a showcase of many of the functions in <code>stylehaven</code>,
this is a simplified redo of several charts from the 2021 DCWS launch
event, using data that’s bundled up with this package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CT-Data-Haven/stylehaven" class="external-link">stylehaven</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/showtext" class="external-link">showtext</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html" class="external-link">showtext_auto</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_opts.html" class="external-link">showtext_opts</a></span><span class="op">(</span>dpi <span class="op">=</span> <span class="fl">150</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="unified-styling-setup">Unified styling setup<a class="anchor" aria-label="anchor" href="#unified-styling-setup"></a>
</h2>
<p>Illustrates:</p>
<ul>
<li>Creating multiple weights of a font to use across all charts with
<code>font_add_weights</code>
</li>
<li>Creating an array of color palettes based on a primary color</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/font_add_weights.html">font_add_weights</a></span><span class="op">(</span><span class="st">"Barlow Semi Condensed"</span>, semibold <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Registering the following fonts:</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">Barlow Semi Condensed</span> with regular weight 400 and bold weight 700</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">Barlow Semi Condensed Semibold</span> with semibold weight 500 and black weight 900</span></span>
<span></span>
<span><span class="va">base_col</span> <span class="op">&lt;-</span> <span class="st">"#5e3da7"</span></span>
<span><span class="va">palx_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/palx.html">palx</a></span><span class="op">(</span><span class="va">base_col</span>, n_shades <span class="op">=</span> <span class="fl">5</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="dcws_example_plots_files/figure-html/style-1.png" width="100%"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qual_pal</span> <span class="op">&lt;-</span> <span class="va">palx_colors</span><span class="op">$</span><span class="va">shade03</span></span>
<span><span class="co"># use with offset labels to make nearly-white labels inside bars, dark gray labels outside</span></span>
<span><span class="va">tf_pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="va">palx_colors</span><span class="op">[[</span><span class="st">"shade02"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"gray"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="va">palx_colors</span><span class="op">[[</span><span class="st">"shade05"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"gray"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">theme_bar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">camiller</span><span class="fu">::</span><span class="fu"><a href="https://camille-s.github.io/camiller/reference/theme_din.html" class="external-link">theme_din</a></span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Barlow Semi Condensed"</span>, ygrid <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.caption.position <span class="op">=</span> <span class="st">"plot"</span>, </span>
<span>          strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Barlow Semi Condensed Semibold"</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">theme_bar</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/update_defaults.html" class="external-link">update_geom_defaults</a></span><span class="op">(</span><span class="st">"col"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">base_col</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/update_defaults.html" class="external-link">update_geom_defaults</a></span><span class="op">(</span><span class="st">"text"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3.5</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, family <span class="op">=</span> <span class="st">"Barlow Semi Condensed"</span>, color <span class="op">=</span> <span class="va">tf_pal</span><span class="op">[[</span><span class="st">"FALSE"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pal4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">qual_pal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"blue"</span>, <span class="st">"teal"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>I’ll keep all the plots in one named list, and all their output
parameters (width &amp; height, could also include something like logo
placement) in another named list. Then I’ll map over these to save all
the plots as PDF and PNG. Having a list of widths &amp; heights also
makes it easier to have the same dimensions within this document (as
chunk <code>fig.width</code> and <code>fig.height</code>) as they have
once they’re exported. Doing this prints an error when running chunks
for some reason but you can ignore it.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plot_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  financial_insecurity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>w <span class="op">=</span> <span class="fl">6</span>, h <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  govt_trend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>w <span class="op">=</span> <span class="fl">5</span>, h <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  cohesion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>w <span class="op">=</span> <span class="fl">5</span>, h <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="facetted-bar-chart">Facetted bar chart<a class="anchor" aria-label="anchor" href="#facetted-bar-chart"></a>
</h2>
<p>Illustrates:</p>
<ul>
<li>Offsetting labels across multiple scales with
<code>offset_lbls</code>
</li>
<li>Lil bit of string formatting functions</li>
<li>This won’t show up when rendered, but I’ve set
<code>fig.width=plot_params$financial_insecurity$w, fig.height=plot_params$financial_insecurity$h</code>
for this chunk</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">financial_to_plot</span> <span class="op">&lt;-</span> <span class="va">fin_insecurity</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Connecticut"</span>, <span class="st">"Greater New Haven"</span>, <span class="st">"Age"</span>, <span class="st">"Race/Ethnicity"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>category <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_collapse.html" class="external-link">fct_collapse</a></span><span class="op">(</span><span class="va">category</span>, Total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Connecticut"</span>, <span class="st">"Greater New Haven"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/offset_lbls.html">offset_lbls</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span>, frac <span class="op">=</span> <span class="fl">0.02</span>, thresh <span class="op">=</span> <span class="fl">0.2</span>, fun <span class="op">=</span> <span class="va">percent100</span><span class="op">)</span></span>
<span><span class="va">financial_to_plot</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 27 × 9</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   question [3]</span></span></span>
<span><span class="co">#&gt;    question           category   group value is_small     off      y  just lbl  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> food_insecurity    Total      Conn…  0.13 FALSE    -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.122      1 13%  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> food_insecurity    Total      Grea…  0.13 FALSE    -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.122      1 13%  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> food_insecurity    Age        Ages…  0.18 FALSE    -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.172      1 18%  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> food_insecurity    Age        Ages…  0.2  FALSE    -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.192      1 20%  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> food_insecurity    Age        Ages…  0.1  FALSE    -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.092<span style="text-decoration: underline;">4</span>     1 10%  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> food_insecurity    Age        Ages…  0.05 TRUE      0.011<span style="text-decoration: underline;">4</span> 0.061<span style="text-decoration: underline;">4</span>     0 5%   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> food_insecurity    Race/Ethn… White  0.09 FALSE    -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.082<span style="text-decoration: underline;">4</span>     1 9%   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> food_insecurity    Race/Ethn… Black  0.2  FALSE    -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.192      1 20%  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> food_insecurity    Race/Ethn… Lati…  0.38 FALSE    -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.372      1 38%  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> housing_insecurity Total      Conn…  0.08 FALSE    -<span style="color: #BB0000;">0.003</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.076<span style="text-decoration: underline;">4</span>     1 8%   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 17 more rows</span></span></span>
<span></span>
<span><span class="va">plots</span><span class="op">[[</span><span class="st">"financial_insecurity"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">financial_to_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">lbl</span>, y <span class="op">=</span> <span class="va">y</span>, hjust <span class="op">=</span> <span class="va">just</span>, color <span class="op">=</span> <span class="va">is_small</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/scale_y_barcontinuous.html">scale_y_barcontinuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">tf_pal</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free"</span>, space <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">camiller</span><span class="fu">::</span><span class="va"><a href="https://camille-s.github.io/camiller/reference/clean_titles.html" class="external-link">clean_titles</a></span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Younger adults and Latinos face hurdles to accessing basic needs"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Share of adults, 2021"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots</span><span class="op">[[</span><span class="st">"financial_insecurity"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="dcws_example_plots_files/figure-html/financial-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="labeling-endpoints">Labeling endpoints<a class="anchor" aria-label="anchor" href="#labeling-endpoints"></a>
</h2>
<p><code>endpoint_lbls</code> adds columns for labels that are offset
slightly to the left for the lower limit and to the right for the upper
limit, a corresponding hjust value to align left-hand labels at the end
of the string and right-hand labels at the start of the string, and
labels to use that include the grouping variable on one or both sides.
This encourages direct labeling to wean yourself away from legends.</p>
<p>One thing to deal with here is the margins of the plot: You can set
padding with <code>expansion</code>, but that changes the limits of the
scale as well, so you might need to adjust your breaks. That’s easy
enough for slopegraphs like this but could get annoying if you don’t
know exactly what the breaks will need to be.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">govt_trend</span> <span class="op">&lt;-</span> <span class="va">cws_trend</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">indicator</span> <span class="op">==</span> <span class="st">"local_govt_responsive"</span>,</span>
<span>         <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>         <span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Total"</span>, <span class="st">"Race/Ethnicity"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">govt_left</span> <span class="op">&lt;-</span> <span class="va">govt_trend</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/endpoint_lbls.html">endpoint_lbls</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, value <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">group</span>, </span>
<span>                fun <span class="op">=</span> <span class="va">percent100</span>, long_side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 8</span></span></span>
<span><span class="co">#&gt;    year indicator             category       group  value     x  just lbl       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>015 local_govt_responsive Total          Total   0.49 <span style="text-decoration: underline;">2</span>015.     1 Total: 49%</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>015 local_govt_responsive Race/Ethnicity White   0.52 <span style="text-decoration: underline;">2</span>015.     1 White: 52%</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>015 local_govt_responsive Race/Ethnicity Black   0.37 <span style="text-decoration: underline;">2</span>015.     1 Black: 37%</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>015 local_govt_responsive Race/Ethnicity Latino  0.46 <span style="text-decoration: underline;">2</span>015.     1 Latino: 4…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>021 local_govt_responsive Total          Total   0.57 <span style="text-decoration: underline;">2</span>021.     0 57%       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>021 local_govt_responsive Race/Ethnicity White   0.63 <span style="text-decoration: underline;">2</span>021.     0 63%       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>  <span style="text-decoration: underline;">2</span>021 local_govt_responsive Race/Ethnicity Black   0.42 <span style="text-decoration: underline;">2</span>021.     0 42%       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>  <span style="text-decoration: underline;">2</span>021 local_govt_responsive Race/Ethnicity Latino  0.48 <span style="text-decoration: underline;">2</span>021.     0 48%</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">govt_left</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">group</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">lbl</span>, x <span class="op">=</span> <span class="va">x</span>, hjust <span class="op">=</span> <span class="va">just</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2021</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">pal4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Views of local government are improving"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Share of adults who agree that local government is responsive,\nConnecticut, 2015–2021"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dcws_example_plots_files/figure-html/govt1-1.png" width="100%"></p>
<p>If I want to switch sides for the long label, the only thing I need
to change is the padding on the x-axis—everything else is in the data
frame.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">govt_right</span> <span class="op">&lt;-</span> <span class="va">govt_trend</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/endpoint_lbls.html">endpoint_lbls</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, value <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">group</span>, </span>
<span>                fun <span class="op">=</span> <span class="va">percent100</span>, long_side <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="co"># this is the default side</span></span>
<span></span>
<span><span class="va">plots</span><span class="op">[[</span><span class="st">"govt_trend"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">govt_right</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">group</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">lbl</span>, x <span class="op">=</span> <span class="va">x</span>, hjust <span class="op">=</span> <span class="va">just</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># in practice I might use ggrepel</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2021</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">pal4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Views of local government are improving"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Share of adults who agree that local government is responsive,\nConnecticut, 2015–2021"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots</span><span class="op">[[</span><span class="st">"govt_trend"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="dcws_example_plots_files/figure-html/govt2-1.png" width="100%"></p>
<p>For just a few lines, full labels on just the left or right is fine,
but there’s also the option to add labels on both sides, which can help
make more lines easier to read</p>
</div>
<div class="section level2">
<h2 id="separating-squished-labels">Separating squished labels<a class="anchor" aria-label="anchor" href="#separating-squished-labels"></a>
</h2>
<p>Dot plots with points directly labeled are great until the values are
too close together, and then it’s a pain to keep the labels from
overlapping. One nice way to handle this is to calculate the distance
between points on each line (whatever’s the independent variable) and
offset labels that are within some threshold of any other label. The
data frame this returns can be used with <code>semi_join</code> and
<code>anti_join</code> to make 2 calls to
<code>geom_text</code>/<code>geom_text_repel</code>. The argument
<code>thresh = 0.03</code> means values with a difference of 0.03 will
be considered too close; this is an absolute value.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohesion</span> <span class="op">&lt;-</span> <span class="va">community_cohesion</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater New Haven"</span>, <span class="st">"Education"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cohesion</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">question</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="../reference/number_formats.html">percent100</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">camiller</span><span class="fu">::</span><span class="va"><a href="https://camille-s.github.io/camiller/reference/clean_titles.html" class="external-link">clean_titles</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">pal4</span>,</span>
<span>                     guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"11"</span>, color <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use the `linewidth` argument instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="dcws_example_plots_files/figure-html/dots1-1.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">to_dodge</span> <span class="op">&lt;-</span> <span class="va">cohesion</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/dodge_lbls.html">dodge_lbls</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">question</span>, value <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">group</span>, thresh <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   question             group                      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> positive_role_models High school or less        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> positive_role_models Some college or Associate's</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> satisfied_with_area  High school or less        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> satisfied_with_area  Some college or Associate's</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span><span class="op">[[</span><span class="st">"cohesion"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cohesion</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">question</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="../reference/number_formats.html">percent100</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">to_dodge</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"question"</span>, <span class="st">"group"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="../reference/number_formats.html">percent100</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">semi_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">to_dodge</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"question"</span>, <span class="st">"group"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">3</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, family <span class="op">=</span> <span class="st">"Barlow Semi Condensed"</span>,</span>
<span>            direction <span class="op">=</span> <span class="st">"x"</span>, nudge_x <span class="op">=</span> <span class="fl">0.2</span>, min.segment.length <span class="op">=</span> <span class="fl">2</span>, seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            segment.color <span class="op">=</span> <span class="va">tf_pal</span><span class="op">[[</span><span class="st">"TRUE"</span><span class="op">]</span><span class="op">]</span>, box.padding <span class="op">=</span> <span class="fl">0.5</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">camiller</span><span class="fu">::</span><span class="va"><a href="https://camille-s.github.io/camiller/reference/clean_titles.html" class="external-link">clean_titles</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">pal4</span>,</span>
<span>                     guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"11"</span>, color <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots</span><span class="op">[[</span><span class="st">"cohesion"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="dcws_example_plots_files/figure-html/dots3-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="batch-writing-image-files">Batch writing image files<a class="anchor" aria-label="anchor" href="#batch-writing-image-files"></a>
</h2>
<p>After exporting about 5,000 plots for the equity reports, I’m excited
to codify a way to go from the above lists of plots and plot parameters
and not have to think about how to write all those plots out, adding
&amp; scaling logos. I didn’t have a good way to test out lots of
different graphics devices on different platforms, so file a Github
issue if any exports don’t work.</p>
<p>By default, this will add a logo (using
<code><a href="../reference/add_logo.html">stylehaven::add_logo</a></code>) and adjust the height of the plot to
fit so that the aspect ratio stays the same even after appending the
logo to the bottom of the image.</p>
<p>Writing out one plot (by default, both PNG &amp; PDF):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"plots"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">out_dir</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">out_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/write_plot.html">write_plot</a></span><span class="op">(</span><span class="va">plots</span><span class="op">$</span><span class="va">govt_trend</span>, filename <span class="op">=</span> <span class="st">"government_trend"</span>, </span>
<span>           dir <span class="op">=</span> <span class="va">out_dir</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">150</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">out_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "pdf/government_trend.pdf" "png/government_trend.png"</span></span></code></pre></div>
<p>Even better, iterating over the plots and plot params to write all
the plots. One thing to note here is to be careful that you’re matching
plots and params if they’re in separate lists: you might get messed up
if these lists are out of order, even if they’re named. (This once
bothered me enough to post a <a href="https://stackoverflow.com/q/55798573/5325862" class="external-link">question on Stack
Overflow</a>.) You can map over one list and use its names to pull
entries out of the other list.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">iwalk</a></span><span class="op">(</span><span class="va">plots</span>, <span class="kw">function</span><span class="op">(</span><span class="va">pl</span>, <span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="va">plot_params</span><span class="op">[[</span><span class="va">id</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="../reference/write_plot.html">write_plot</a></span><span class="op">(</span><span class="va">pl</span>, filename <span class="op">=</span> <span class="va">id</span>, dir <span class="op">=</span> <span class="va">out_dir</span>,</span>
<span>             width <span class="op">=</span> <span class="va">ps</span><span class="op">$</span><span class="va">w</span>, height <span class="op">=</span> <span class="va">ps</span><span class="op">$</span><span class="va">h</span>, dpi <span class="op">=</span> <span class="fl">150</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">out_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "pdf/cohesion.pdf"             "pdf/financial_insecurity.pdf"</span></span>
<span><span class="co">#&gt; [3] "pdf/government_trend.pdf"     "pdf/govt_trend.pdf"          </span></span>
<span><span class="co">#&gt; [5] "png/cohesion.png"             "png/financial_insecurity.png"</span></span>
<span><span class="co">#&gt; [7] "png/government_trend.png"     "png/govt_trend.png"</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Camille Seaberry.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
