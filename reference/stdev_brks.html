<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create labeled intervals based on standard deviations — stdev_brks • stylehaven</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create labeled intervals based on standard deviations — stdev_brks"><meta name="description" content="Occasionally we make charts using standard deviations away from an average value to fill bars or geographies—not a hard task, but tedious. This function takes a data frame, then gets a midpoint value, either by calculating the mean or by filtering for an observation already in the data frame (such as a statewide value). It then calculates z-scores based on this midpoint and standard deviation, then cuts z-scores based on brks. Pay close attention to the argument by, which allows you to do these calculations grouped by some column; this is useful if you have a data frame of several different indicators. Alternatively, passing a grouped data frame will also do the calculations by group."><meta property="og:description" content="Occasionally we make charts using standard deviations away from an average value to fill bars or geographies—not a hard task, but tedious. This function takes a data frame, then gets a midpoint value, either by calculating the mean or by filtering for an observation already in the data frame (such as a statewide value). It then calculates z-scores based on this midpoint and standard deviation, then cuts z-scores based on brks. Pay close attention to the argument by, which allows you to do these calculations grouped by some column; this is useful if you have a data frame of several different indicators. Alternatively, passing a grouped data frame will also do the calculations by group."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stylehaven</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/dcws_example_plots.html">Plot examples from the DCWS launch</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CT-Data-Haven/stylehaven/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create labeled intervals based on standard deviations</h1>
      <small class="dont-index">Source: <a href="https://github.com/CT-Data-Haven/stylehaven/blob/main/R/stdev_brks.R" class="external-link"><code>R/stdev_brks.R</code></a></small>
      <div class="d-none name"><code>stdev_brks.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Occasionally we make charts using standard deviations away from an average value to fill bars or geographies—not a hard task, but tedious. This function takes a data frame, then gets a midpoint value, either by calculating the mean or by filtering for an observation already in the data frame (such as a statewide value). It then calculates z-scores based on this midpoint and standard deviation, then cuts z-scores based on <code>brks</code>. Pay close attention to the argument <code>by</code>, which allows you to do these calculations grouped by some column; this is useful if you have a data frame of several different indicators. Alternatively, passing a grouped data frame will also do the calculations by group.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stdev_brks</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  value <span class="op">=</span> <span class="va">value</span>,</span>
<span>  filters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  brks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  keep_calcs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A data frame or tibble</p></dd>


<dt id="arg-value">value<a class="anchor" aria-label="anchor" href="#arg-value"></a></dt>
<dd><p>Bare name of the numeric value column, Default: value</p></dd>


<dt id="arg-filters">filters<a class="anchor" aria-label="anchor" href="#arg-filters"></a></dt>
<dd><p>An optional named list of values to use for filtering. If given, the observation matching these values will be used as the midpoint. If NULL (the default), the midpoint will be calculated as the mean of values, grouped by <code>x</code>'s grouping columns (if any) and the arguments to <code>by</code> (also if any).</p></dd>


<dt id="arg-by">by<a class="anchor" aria-label="anchor" href="#arg-by"></a></dt>
<dd><p>Optional character vector. If given, this will be used as the group within which intervals are calculated. Default: NULL</p></dd>


<dt id="arg-brks">brks<a class="anchor" aria-label="anchor" href="#arg-brks"></a></dt>
<dd><p>Numeric vector of break points for cutting z-scores. This vector, plus <code>-Inf</code> and <code>Inf</code>, will be passed to <code><a href="https://rdrr.io/r/base/cut.html" class="external-link">base::cut</a></code>'s <code>breaks</code> argument. Default: c(-2, -1/2, 1/2, 2)</p></dd>


<dt id="arg-labels">labels<a class="anchor" aria-label="anchor" href="#arg-labels"></a></dt>
<dd><p>Character vector of labels for the resulting factor. If NULL, levels will be in <code><a href="https://rdrr.io/r/base/cut.html" class="external-link">base::cut</a></code>'s interval notation. The length of this vector should be one more than the length of <code>brks</code>. Default: NULL</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Boolean passed on to <code>mean</code> if midpoints are being calculated. Default: TRUE</p></dd>


<dt id="arg-keep-calcs">keep_calcs<a class="anchor" aria-label="anchor" href="#arg-keep-calcs"></a></dt>
<dd><p>Boolean, whether to keep columns from calculations. Default: TRUE</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="https://rdrr.io/r/base/cut.html" class="external-link">base::cut</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame or tibble with the same number of rows as <code>x</code>. If <code>keep_calcs</code> is true, the returned data frame will have numeric columns added for midpoint (<code>midpt</code>), standard deviation (<code>sd</code>), and z-score (<code>z</code>), and a factor column for the resulting intervals (<code>brk</code>). If false, the only column added will be the intervals.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/base/cut.html" class="external-link">base::cut()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Calculate intervals along the full dataset, based on calculated mean</span></span></span>
<span class="r-in"><span><span class="fu">stdev_brks</span><span class="op">(</span><span class="va">life_exp</span>, </span></span>
<span class="r-in"><span>           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lower"</span>, <span class="st">"Somewhat lower"</span>, <span class="st">"Average"</span>, <span class="st">"Somewhat higher"</span>, <span class="st">"Higher"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 189 × 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    tract       town      value midpt    sd      z brk            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 09009142500 New Haven  75.6  79.3  3.11 -<span style="color: #BB0000;">1.19</span>  Somewhat lower </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 09009361402 New Haven  <span style="color: #BB0000;">NA</span>    79.3  3.11 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 09009140900 New Haven  77.9  79.3  3.11 -<span style="color: #BB0000;">0.447</span> Average        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 09009142000 New Haven  82.5  79.3  3.11  1.03  Somewhat higher</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 09009141800 New Haven  82.3  79.3  3.11  0.970 Somewhat higher</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 09009140300 New Haven  76.9  79.3  3.11 -<span style="color: #BB0000;">0.769</span> Somewhat lower </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 09009142700 New Haven  80.4  79.3  3.11  0.358 Average        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 09009140100 New Haven  80.3  79.3  3.11  0.326 Average        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 09009142100 New Haven  <span style="color: #BB0000;">NA</span>    79.3  3.11 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 09009141200 New Haven  77    79.3  3.11 -<span style="color: #BB0000;">0.736</span> Somewhat lower </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 179 more rows</span></span>
<span class="r-in"><span>           </span></span>
<span class="r-in"><span><span class="co"># Calculate intervals for each of the three indicators in the `question` column. </span></span></span>
<span class="r-in"><span><span class="co"># Both examples have the same result:</span></span></span>
<span class="r-in"><span><span class="va">fin_insecurity</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">stdev_brks</span><span class="op">(</span>filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>category <span class="op">=</span> <span class="st">"Connecticut"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"question"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 69 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    question        category          group       value midpt     sd      z brk  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> food_insecurity Connecticut       Connecticut  0.13  0.13 0.088<span style="text-decoration: underline;">9</span>  0     (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> food_insecurity Greater New Haven Greater Ne…  0.13  0.13 0.088<span style="text-decoration: underline;">9</span>  0     (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> food_insecurity Gender            Men          0.12  0.13 0.088<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.112</span> (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> food_insecurity Gender            Women        0.14  0.13 0.088<span style="text-decoration: underline;">9</span>  0.112 (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> food_insecurity Age               Ages 18-34   0.18  0.13 0.088<span style="text-decoration: underline;">9</span>  0.562 (0.5…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> food_insecurity Age               Ages 35-49   0.2   0.13 0.088<span style="text-decoration: underline;">9</span>  0.787 (0.5…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> food_insecurity Age               Ages 50-64   0.1   0.13 0.088<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.337</span> (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> food_insecurity Age               Ages 65+     0.05  0.13 0.088<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.899</span> (-2,…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> food_insecurity Race/Ethnicity    White        0.09  0.13 0.088<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.450</span> (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> food_insecurity Race/Ethnicity    Black        0.2   0.13 0.088<span style="text-decoration: underline;">9</span>  0.787 (0.5…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 59 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fin_insecurity</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">stdev_brks</span><span class="op">(</span>filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>category <span class="op">=</span> <span class="st">"Connecticut"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 69 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   question [3]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    question        category          group       value midpt     sd      z brk  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> food_insecurity Connecticut       Connecticut  0.13  0.13 0.088<span style="text-decoration: underline;">9</span>  0     (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> food_insecurity Greater New Haven Greater Ne…  0.13  0.13 0.088<span style="text-decoration: underline;">9</span>  0     (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> food_insecurity Gender            Men          0.12  0.13 0.088<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.112</span> (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> food_insecurity Gender            Women        0.14  0.13 0.088<span style="text-decoration: underline;">9</span>  0.112 (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> food_insecurity Age               Ages 18-34   0.18  0.13 0.088<span style="text-decoration: underline;">9</span>  0.562 (0.5…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> food_insecurity Age               Ages 35-49   0.2   0.13 0.088<span style="text-decoration: underline;">9</span>  0.787 (0.5…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> food_insecurity Age               Ages 50-64   0.1   0.13 0.088<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.337</span> (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> food_insecurity Age               Ages 65+     0.05  0.13 0.088<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.899</span> (-2,…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> food_insecurity Race/Ethnicity    White        0.09  0.13 0.088<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.450</span> (-0.…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> food_insecurity Race/Ethnicity    Black        0.2   0.13 0.088<span style="text-decoration: underline;">9</span>  0.787 (0.5…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 59 more rows</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Camille Seaberry.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

